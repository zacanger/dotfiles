
<!-- saved from url=(0036)http://9ol.es/The5HardestThings.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>The Five Hardest Parts of Programming</title><meta name="description" content="What you can only learn through pain, practice, and patience.">
<link rel="stylesheet" href="http://9ol.es/blog.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
em{padding:0 10px;margin:18px 5px; display:block;width:475px;font-size:0.9em;border-left: 2px solid #ddF}
li div{margin:-0.25em 0 0;border:0;font-size:0.9em;width:475px}
em b{display:block}
th{text-align:left}
q{width:450px;margin:10px;display:block;line-height:1.65em;background:#ffe;padding:15px;font-size:0.9em;border:1px solid #ddc}
q p{margin:1em 0.5em;width:95%}
q:before{content:""}
q:after{content:""}
p{line-height:1.75em;width:100%;font-size:1em}
tt{display:inline-block;margin:0;padding:0;font-size:1.1em}
h1{width:auto;margin:30px 0 10px}
h2{margin:1em 0;width:400px}
h3{font-size:1.3em;font-weight:normal;margin:1.5em 0 -0.4em}
h4{margin:40px 0 -0.4em 0;font-size:1.05em;font-weight:normal}
h5{margin:0;font-size:1em;font-weight:normal}
h6{font-size:0.95em;margin:10px 0 0.5em 0}
code span{display:block;margin:0;padding:0}
p.h5{margin-left:1.5em}
sup,sub{line-height:0}
h2 a{display:inline-block;font-size:0.5em;text-decoration:none;color:#a8f;margin-right:3em}
cite,i{font-family:Palatino Linotype,Book Antiqua3,Palatino,serif;font-size:1.1em}
cite{margin:5px -5px -10px 0;display:block;font-weight:bold;color:#446;font-family:Palatino Linotype,Book Antiqua,Palatino,serif;display:block;width:510px;text-align:center;color:#446}
cite a{color:#99c}
a{color:#12c}
a:visited{color:#206}
caption{font-size:0.85em;font-style:italics}
.h5 b{margin-left:-1em;margin-right:0.5em}
sup a{text-decoration:none}
.copy{color:#aaa;font-size:0.9em;display:block;text-align:center}
#content{width:560px;display:block;vertical-align:top;margin-left:50px}
#content li{line-height:1.75em;margin-top:.5em;max-width:420px}
.emp{color:#000;background:#cec}
.pre *{font-family:monospace}
.break{display:block;margin:3em 0 1em 0;margin-left:220px}
#toc{margin-top:0.5em}
#toc a{display:inline-block;background:tan;width:23%;padding:1.75%;border:2px solid tan;margin:1%;text-align:center;font-size:1.15em;text-decoration:none;color:brown}
#toc a:hover{background:brown;color:tan}
.cen{display:block;margin-top:2em;width:510px;background:url("http://vukkake.com/fleur.png") 220px 0px no-repeat;height:30px}
h2 small{display:block;font-size:0.8em;line-height:1.5em;font-weight:normal}
table{border:1px solid #ddf}
table td,
table th{padding:3px}
table th,
table th a{font-family:Palatino Linotype,Book Antiqua3,Palatino,serif;font-weight:normal;border-bottom:1px solid #ccf}
.notes{border-top:1px solid #888;font-size:0.8em}
.right{margin:0.5em 0 0.5em 0.5em;position:relative;float:right;width:200px;text-align:left;line-height:1.6em;background:#ffffea;padding:0.75em 1em 1.25em;border:1px solid #fee;border-width:1px 0 2px 0}
.right i{width:100%;color:#88c;line-height:1.25em;position:absolute;bottom:0.35em;font-size:11px;text-align:right;right:0.5em;font-family:Verdana;font-style:normal;font-weight:normal;text-transform:lowercase}
.right a{color:#88c}
pre{background:#eeeef4;padding:1em;width:400px;line-height:1.75em}
</style>
</head>
<body><div id="content"><a name="toc"></a>
<h1>The 5 Hardest Parts of Programming</h1>
<a href="http://9ol.es/The5HardestThings.html#Introduction">Introduction</a>
<ol>
<li><a href="http://9ol.es/The5HardestThings.html#Optimization">Optimization</a>
</li><li><a href="http://9ol.es/The5HardestThings.html#Networking">Networking</a>
</li><li><a href="http://9ol.es/The5HardestThings.html#Security">Security</a>
</li><li><a href="http://9ol.es/The5HardestThings.html#Reliability">Reliability</a>
</li><li><a href="http://9ol.es/The5HardestThings.html#Scalability">Scalability</a>
</li></ol>
<a href="http://9ol.es/The5HardestThings.html#Conclusion">Conclusion</a>
<!--<p style="text-align:center;color:#aaa;font-size:0.7em;width:520px;margin-bottom:0;padding-bottom:0">Download a <a style=color:#aaf href=http://vukkake.com/5HardestThings.pdf>PDF version</a> of this document, suitable for printing.</p>-->
<a name="Introduction"></a>
<div class="cen"></div>
<h2>Introduction</h2>
<p>Many things in programming become easier as your level of experience increases.  However, some things remain stubbornly difficult.</p>
<p>This document tries to characterize five of these difficult things; optimization, networking, security, reliability and scalability, what makes them hard and what you can do about it.</p>
<p>As intractable as they are common and necessary, the five things above share a few important traits:</p>
<ul>
<li>It's easy to visualize what it would mean for your product to have each one.
</li><li>They each mean something different every time.
</li><li>The problems they encompass are difficult to prepare for.
</li><li>They are dimensional in nature.
</li><li>Being satisfied with your implementations almost never happens.
</li><li>Addressing them effectively is part of the art of programming.
</li></ul>
<a name="Optimization"></a>
<div class="cen"></div>
<h2><a href="http://9ol.es/The5HardestThings.html#toc">⇪ Table of Contents</a> <a href="http://9ol.es/The5HardestThings.html#Networking">Networking ⇨</a>
<small>Chapter 1</small>
Optimization</h2>
<h3>What is it?</h3>
<p>Doing more things with less stuff.</p>
<p>Sometimes this is expressed experientially in that user feedback <a href="http://en.wikipedia.org/wiki/Principles_of_user_interface_design">isn't coming back quick enough</a>. Other times it's a real problem, e.g. you are getting input at some rate <i>X</i>, but you can only process it at some rate <i>¾X</i>, and thus <a href="http://en.wikipedia.org/wiki/Producer-consumer_problem">you are in trouble</a>. Oftentimes the "stuff" is runtime related, but other limiting factors may include things like bitrate or power consumption.</p>
<h3>Why does it sound easy?</h3>
<p>Every programmer with a Bachelors degree should have taken an algorithms course. They should know about <a href="http://en.wikipedia.org/wiki/Big_O_notation">Big-O notation</a>. They probably also have in their bag of tricks some rules of thumbs, things like "Floating point arithmetic <a href="http://stackoverflow.com/questions/2550281/floating-point-vs-integer-calculations-on-modern-hardware">is slow</a>" or "String comparison is slow" or other mantras. When looking at an optimization problem, it's easy to think "Do <a href="http://en.wikipedia.org/wiki/Static_program_analysis">static analysis</a>, create some <a href="http://en.wikipedia.org/wiki/Unit_testing">unit tests</a>, I got this".</p>
<h3>Why is it hard?</h3>
<p>The problem is that these methods are either ineffective or irrelevant. Sure, the <i>O(2^N)</i> algorithm <a href="http://www.wolframalpha.com/input/?i=2%5En%2C+n+%28n+from+0+to+10%29">is slower</a> than the <i>O(N)</i> one. If that's your only problem you're in the clear.</p>
<p>However, assume nobody was that careless and optimization is still a goal, the best you can do, measurement driven optimization,
 is only about as assured as <a href="http://en.wikipedia.org/wiki/Card_counting">card-counting</a> at a Black Jack table.</p>
<a name="Optimization.measurement"></a>
<h4>Measurement Driven Optimization</h4>
<p>Before going further, let's talk about the four types of programmers:</p>
<ol>
<li>The hardware tinkerers who write assembly and know the very soul of the processor.
</li><li>The compiled-language developer, writing platforms and frameworks these days.
</li><li>The application-level script-writing programmer, commonly writing web apps.
</li><li>The business-person first, programmer-second <a href="http://en.wikipedia.org/wiki/Search_engine_optimization">SEO</a> or <a href="http://wordpress.org/">WordPress</a> programmer.
</li></ol>
<p>The first group, you people are fine. You can probably skip this. But the other 99% of you are sitting on a complex world. If you think these rules of thumb on how to make your program faster are true and you don't need to do extensive careful measurements, you are probably mistaken.</p>
<p>What runs fast on your computer may not run fast on the clients, unless you control the whole stack. For instance, there's <a href="http://ejohn.org/blog/javascript-performance-rundown/">vast</a> performance <a href="http://expansive-derivation.ossreleasefeed.com/2011/08/javascript-performance-test-results-with-sunspider/">differences</a> in Javascript <a href="http://www.codinghorror.com/blog/2007/12/the-great-browser-javascript-showdown.html">runtime</a>. Here <a href="http://ie.microsoft.com/testdrive/benchmarks/sunspider/default.html">Microsoft claims</a> that IE9 is an order of magnitude faster than IE8.<sup></sup> In what? <a href="http://stackoverflow.com/questions/6817093/but-whys-the-browser-dom-still-so-slow-after-10-years-of-effort">Traversing the DOM</a>? <a href="http://mark-story.com/posts/view/speed-up-javascript-event-handling-with-event-delegation-and-bubbling">Event propagation</a>? Parsing JSON? Only the first one if the other two aren't happening at the same time?</p>
<p>Optimization needs a plan, just like anything else. The following questions will help you make this plan:</p>
<ul>
<li>What am I doing?
<div>What are concrete, real-world goals that your software is addressing?</div>
</li><li>How am I doing it?
<div>How have you modeled these real-world goals?</div>
</li><li>Where am I doing it?
<div>Is the system <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a> and cohesive?</div>
</li><li>When am I doing it?
<div>How coupled is your presentation and computation?</div>
</li></ul>
<p>Answering these questions may guide you in deriving your performance numbers. But watch out, measurements can be deceiving!</p>
<p>Here's an example in Ruby:</p>
<p>I have a string, "hello". This will test whether the first character is an "h". Here's three methods:</p>
<ol>
<li><code>"hello"[0] == ?h</code>
<label>Take the first index of the string (outputs as the numeric value of its ASCII character), convert "h" to its numeric value, then compares two integers.</label>
</li><li><code>/^h/ =~ "hello"</code>
<label>Construct a <a href="http://www.pcre.org/">regular expression</a> and then use a Perlish match against the string.</label>
</li><li><code>"hello"[0].chr == 'h'</code>
<label> Take the first index, convert it to a char, compare it to an 'h'.</label>
</li></ol>
<em><b>Note</b>This is called micro-optimization and is a useless form of optimization. Stick with me for now though.</em>
<pre>1000000.times do 
  # "hello"[0] == ?h
  # /^h/ =~ "hello"
  # "hello"[0].chr == 'h'
end
</pre>
<p>Before looking at the numbers below, rank the methods described above from fastest to slowest. See how your guesses match what is measured below.</p>
<p>An <a href="http://releases.ubuntu.com/12.04/">Ubuntu 12.04</a> machine using the <a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?time">/usr/bin/time</a> command yielded the following numbers averaged over five trials:</p>
<table>
<caption align="bottom">/usr/bin/time performance numbers</caption>
<thead>
  <tr><th>Method</th><th>Time: <a href="http://stackoverflow.com/questions/556405/what-do-real-user-and-sys-mean-in-the-output-of-time1">user/real</a></th><th>Rank</th></tr>
</thead>
<tbody>
  <tr><td>"hello"[0] == ?h</td><td>0.622/0.520</td><td>1st</td></tr>
  <tr><td>/^h/ =~ "hello"</td><td>0.727/0.580</td><td>2nd</td></tr>
  <tr><td>"hello"[0].chr == 'h'</td><td>1.026/0.980</td><td>3rd</td></tr>
</tbody>
</table>
<p>The first and second methods are about the same, with the first method being slightly faster. Remember the rankings.</p>
<h4>Do you know what you are measuring?</h4>
<p>Now here is the same test as before, but using the <a href="http://ruby-prof.rubyforge.org/">ruby-prof</a> <a href="http://en.wikipedia.org/wiki/RubyGems">Gem</a>. That is to say that the same tests are profiled with a different methodology.</p>
<p>The hypothesis is that we should see the same pattern of results, the fastest should stay the fastest, the slowest should stay the slowest.</p>
<pre>require 'rubygems'
require 'ruby-prof'

RubyProf.start

1000000.times do 
  # "hello"[0].chr == 'h'
  # "hello"[0] == ?h
  # /^h/ =~ "hello"
end

result = RubyProf.stop
printer = RubyProf::GraphPrinter.new(result)
printer.print(STDOUT, {})
</pre>
<table>
<caption align="bottom">ruby-perf performance numbers</caption>
<thead>
  <tr><th>Method</th><th>Total Time</th><th>Rank</th></tr>
</thead>
<tbody>
  <tr><td>"hello"[0] == ?h</td><td>2.845332828</td><td>2nd</td></tr>
  <tr><td>/^h/ =~ "hello"</td><td>1.511132323</td><td>1st</td></tr>
  <tr><td>"hello"[0].chr == 'h'</td><td>5.099165590</td><td>3rd</td></tr>
</tbody>
</table>
<p>The differences between the two test's results don't match up even in relative terms.</p>
<p>When using the time command, the <i>?h</i> comparison edged slightly ahead of the regex. However, with the ruby-prof profiler the regex method ran in half the time.</p>
<p>As it turns out, profilers <a href="http://au.news.yahoo.com/thewest/a/-/newshome/9580205/tests-show-police-speed-recorder-wrong/">don't always agree</a> because measuring has overhead, methodology, and implementation details.</p>
<p>Knowing how to "fix" numbers generated by your tools requires an understanding of how those numbers are generated. Otherwise, what are you responding to?</p>
<h4>Other Bounds</h4>
<p>You can also be disk bound. To illustrate the problem, get on a Linux or Mac OS X machine. (or Fabrice Bellards' <a href="http://bellard.org/jslinux/">Linux in the browser</a>.)</p>
<p>You are going to create a 32 megabyte file of zeros, all in one go. Open up the shell and type the following in:</p>
<pre>dd if=/dev/zero of=swiftly bs=33554432 count=1</pre>
<p>That was fast. Great. Now we will copy this file, but only one byte at a time:</p>
<pre>dd if=swiftly of=patience bs=1 count=33554432</pre>
<p>This will take much longer. Probably over a minute (took 62 seconds for me).</p>
<p>This is the problem of I/O (currently, in July 2012). When you switch between reading and writing, there's a huge overhead cost. Additionally, when your throughput in that transit is low, you have wasted a lot. Minimizing this is a major focus of database design.</p>
<p>So yes, CPU bound, <a href="http://en.wikipedia.org/wiki/CAS_latency">Memory bound</a>, <a href="http://blogs.gnome.org/abustany/2010/05/20/ipc-performance-the-return-of-the-report/">IO bound</a>, <a href="http://www.idi.ntnu.no/~elster/master-studs/runejoho/ms-proj-gpgpu-latency-bandwidth.pdf">GPU</a>, <a href="http://www.computerworld.com/s/article/9223117/Bandwidth_bottlenecks_loom_large_in_the_cloud">lots</a> of <a href="http://superuser.com/questions/72747/the-bottlenecks-of-any-computer-what-to-look-for">stuff</a> to <a href="http://www.edn.com/electronics-news/4316439/Bottlenecks-in-Parallel-Programming-Hurt-Productivity">slow</a> you down. Worst of all, acting today may be a huge waste of time tomorrow.</p>
<h4>Future-Poof!</h4>
<p>The worst thing is that you at best only know what to look for on your machine, right now, doing certain things.</p>
<p>Historically, optimizing this way hasn't always panned out as expected.</p>
<p>Take something called <a href="http://en.wikipedia.org/wiki/Duff's_device">Duff's Device</a>. Don't worry if you don't understand what's going on, the mechanics of it are irrelevant for this point.</p>
<p>All you need to know is that in the 1980s, using the Duff's Device programming pattern supposedly led to a performance boost. Fast forward to 2000 and <a href="http://lkml.indiana.edu/hypermail/linux/kernel/0008.2/0171.html">this email</a>:</p>
<q><p>Jim Gettys has a wonderful explanation of this effect in the X server. It turns out that with branch predictions and the relative speed of CPUs. memory changing over the past decade, loop unrolling is pretty much pointless. In fact, by eliminating all instances of Duff's Device from the XFree86 4.0 server, the server shrunk in size by <i>half a megabyte</i> (!!!), and was faster to boot, because the elimination of all that excess code meant that the X server wasn't thrashing the cache lines as much.</p>
<p>The bottom line is that our intuitive assumptions of what's fast and what isn't can often be wrong, especially given how much CPU's have changed over the past couple of years.</p>
</q>
<p>So even if you achieve the momentous task of being right about optimization today, there is no guarantee that your measures will help you be right, or even beneficial tomorrow.</p>
<p>Everything is moving at once and it's your job to manage it.</p>
<h4>Don't Micro-Optimize</h4>
<p>Up until this point we've been looking at what is termed <a href="http://www.codinghorror.com/blog/2009/01/the-sad-tragedy-of-micro-optimization-theater.html">micro-optimization</a>. This has been done to make the topic easier to talk about.</p>
<p>Now given that, micro-optimizations are <a href="http://blog.codef00.com/2009/02/11/micro-optimization-is-stupid/">worthless</a>. Do not do them.</p>
<p>Here's a few reasons:</p>
<ul>
<li>Your fancy refactoring tools may get things wrong and birth <a href="http://programmers.stackexchange.com/questions/23182/net-best-practices-common-bugs-introduced-by-refactoring-carelessness-and-n">new and exciting bugs</a>.
</li><li>They at best offer localized, temporary, <a href="http://www.codethinked.com/ditching-the-micro-optimization-fetish">almost unmeasurable</a> boosts in performance.
</li><li>They can often lead to <a href="http://blog.joda.org/2011/11/real-life-scala-feedback-from-yammer.html">issues</a> amongst coders.
</li></ul>
<p>The last one is important if you value your time.</p>
<p>Arguing about optimization is wasteful. It should be easily demonstrable (to the end-user) or it's nonsense.</p>
<p>And even when it's demonstrable, doing it may still be a waste of your time.</p>
<p>Here's a great example, <a href="http://en.wikipedia.org/wiki/Goto">goto</a>. There's a super-famous paper that many quote but few have read titled, <a href="http://dl.acm.org/citation.cfm?id=1241518&coll=ACM&dl=ACM">Go to statement considered harmful</a>. What it argues for, in 1968 (the year that the frame-buffer was developed, and a computer with 32KB of memory cost $50,000<sup></sup>) is that programmers should prefer <a href="http://en.wikipedia.org/wiki/Structured_programming">sub-functions</a> over <a href="http://en.wikipedia.org/wiki/Non-structured_programming">direct jumps</a>.</p>
<p>By doing this, programs will have <a href="http://en.wikipedia.org/wiki/Call_stack">call-stacks</a> enabling programmers to <a href="http://en.wikipedia.org/wiki/Stack_trace">unroll</a> what path <a href="http://en.wikipedia.org/wiki/Subroutine">the code</a> took and thus be more easily able to determine <a href="http://en.wikipedia.org/wiki/Core_dump">what</a> made things go wrong. Principally, gotos (or <a href="http://en.wikipedia.org/wiki/JMP_%28x86_instruction%29">jumps</a>) should more or less be abstracted away from the programmer via higher-order abstractions.</p>
<p>Given this, goto can be a <a href="http://stackoverflow.com/questions/10386152/effect-of-goto-on-c-compiler-optimization">micro-optimization</a>. It says, "I don't care about scope, where I came from, or anything else. Go to this part of the code right now!". You'll often <a href="http://kerneltrap.org/node/553/2131">find</a> gotos <a href="http://eli.thegreenplace.net/2009/04/27/using-goto-for-error-handling-in-c/">peppered</a> by <a href="https://www.securecoding.cert.org/confluence/display/seccode/MEM12-C.+Consider+using+a+Goto-Chain+when+leaving+a+function+on+error+whee+using+and+releasing+resources">respectable programmers</a>.<sup></sup></p>
<p>But now that you know the proper history and intent, you probably shouldn't go off and use goto. Many programmers you will work with will challenge you and <a href="http://xkcd.com/292/">scoff at you</a> for using it because these thoughts on goto constitute part of the programming cultures' <a href="http://en.wikipedia.org/wiki/Group_cohesiveness">group cohesion</a>. Thus you'll have to explain this to them. It's not worth it. It just isn't.</p>
<p>Micro-optimizations will at best give you a temporary performance gain, and at worst, squander your time with arguments during <a href="http://en.wikipedia.org/wiki/Code_review">code reviews</a>. And furthermore, since you aren't going to be the <a href="http://en.wikipedia.org/wiki/Bus_factor">perpetual maintainer</a> of your code, it will probably just be undone in the future.</p>
<p>And maybe such back-tracking will lead to a <i>real improvement</i> when it's done five years from now. Woops, dig yourself out of that one.</p>
<p>Turning your human text into machine code is the job of the compiler or interpreter you are using. When you do things <a href="http://en.wikipedia.org/wiki/Multiway_branch">conventionally</a>, you are doing them in ways that will be the focus of <a href="http://en.wikipedia.org/wiki/Ne-XVP">future optimizations</a>. It's like future <a href="http://www.gccsummit.org/2010/view_abstract.php?content_key=17">eyeballs</a> making your code run <a href="http://en.wikipedia.org/wiki/Interprocedural_optimization">faster</a> for you. When you try to <a href="http://c2.com/cgi/wiki?OutsmartingTheCompiler">outsmart the compiler</a> however, all bets are off.</p>
<a name="Optimization.cache"></a>
<h4>Cache and Woes</h4>
<p>Eventually, almost all programmers have the following epiphany:</p>
<q>I'm asked the same question over and over again. Hah! I'll just stash the result over here, then when the question comes again, I can cheat a bit and have the answer ready.</q>
<p>This brilliant idea is called a <a href="http://en.wikipedia.org/wiki/Cache_(computing)">cache</a>. Sorry, you aren't first to come up with it. Furthermore, cache invalidation <a href="https://www.varnish-software.com/static/book/Cache_invalidation.html">is hard</a>. <a href="http://www.cse.psu.edu/~wlee/Publications/wlee%20MASS04.pdf">Really</a> <a href="http://coherence.oracle.com/display/COH34UG/Near+Cache">hard</a>.</p>
<p>Almost everywhere in the stack, from the <a href="http://en.wikipedia.org/wiki/CPU_cache">CPU</a> on up there's cache. <a href="http://en.wikipedia.org/wiki/Disk_buffer">Hard drives</a> have cache, RAM is kinda a form of cache, people are eying SSDs as some <a href="http://www.pcworld.com/article/248828/how_to_set_up_intel_smart_response_ssd_caching_technology.html">magical cache silver bullet</a>.</p>
<p>Well here's just a few baddies about caches:</p>
<ol>
<li>The thing you are <i>optimizing out</i> may have important side effects you forgot about.
</li><li>The cache may grow unwieldy and then magically <a href="http://technet.microsoft.com/en-us/library/cc722473.aspx">become your bottleneck</a>.
</li><li>The responses from the cache may not be fresh unless <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html">rather sophisticated</a>.
</li><li>The performance and perhaps <a href="http://stackoverflow.com/questions/356551/what-are-best-practices-for-preventing-stale-css-and-javascript">very nature</a> of your application is now less than consistent.
</li></ol>
<p>That is <a href="http://www.cs.cornell.edu/~hitesh/pubs/ccs08-staledns.pdf">what happens</a> when you do cache, wrongly. When you <a href="http://en.wikipedia.org/wiki/Memoization">do it rightly</a>, everything is awesome. But doing it right is a <a href="http://martinfowler.com/bliki/TwoHardThings.html">black art</a> in and of itself. <a href="http://csl.cse.psu.edu/publications/WCW03.pdf">Different</a> <a href="http://www.cs.arizona.edu/classes/cs630/spring12-icn/papers/presentation/WAVE.pdf">things</a> <a href="http://ieeexplore.ieee.org/xpl/login.jsp?tp=&arnumber=5741880&url=http%3A%2F%2Fieeexplore.ieee.org%2Fiel5%2F25%2F5876034%2F05741880.pdf%3Farnumber%3D5741880">matter</a> <a href="http://ieeexplore.ieee.org/xpl/login.jsp?tp=&arnumber=5521596&url=http%3A%2F%2Fieeexplore.ieee.org%2Fxpls%2Fabs_all.jsp%3Farnumber%3D5521596">every</a> <a href="http://www.i-teletraffic.org/fileadmin/ITCBibDatabase/2010/hasslinger10.pdf">time</a>. There's no <a href="http://docs.jboss.org/hibernate/orm/3.3/reference/en/html/performance.html">deterministic way</a> to go about it.</p>
<h4>Macro-Machines</h4>
<p>A more fruitful way to think about optimization is at the macro-level.</p>
<p>You are dealing with a large program with many moving parts. Your key to making things faster is to do less:</p>
<cite class="right">Most performance comes not from the language, but from application design.<i>from <a href="http://highscalability.com/scaling-twitter-making-twitter-10000-percent-faster/">Making twitter 10,000% faster</a></i></cite>
<ol>
<li>Avoid running unnecessary code.
</li><li>Avoid creating unnecessary objects.
</li><li>Avoid unnecessary abstractions.
</li><li>Take the shortest path possible.
</li></ol>
<p>Here's <a href="https://github.com/blog/530-how-we-made-github-fast">a good synopsis</a> of what GitHub did.</p>
<p>Also, enjoy a fantastic re-interpretation of this <a href="http://www.youtube.com/watch?v=cO1a1Ek-HD0">Richard Dawkins'</a> video on YouTube.</p>
<a name="Optimization.sanity"></a>
<h3>What can you do to maintain sanity?</h3>
<p>In summary, here's the problems:</p>
<ul>
<li>Your static analysis intuitions do not appreciate the complexity of the stack under your feet.
</li><li>Measuring tools will disagree even with simple things.
</li><li>You don't know the expectations of performance from your userbase.
</li><li>You are unlikely to get any meaningful gains without trashing large chunks of code, resetting the <a href="http://en.wikipedia.org/wiki/Software_quality_assurance">QA</a> clock.<sup></sup>
</li></ul>
<p>So here's how to do it. <i>Optimization</i> needs a working idea, if not a relativistic definition.</p>
<p>You should be able to complete the sentence, "It's slow because" with a problem-centric finish. For instance, "It's slow because our convergence numbers are going down." or "It's slow because it can't process input fast enough".</p>
<p>When you phrase the problem in this way, then you have your goal. Instead of the amorphous "optimize" you have to get those convergence number up.</p>
<p>You may do so by making stuff faster, you may do so another way. The point is that you dissected what optimization means for your application to see whether it matters at all.</p>
<cite>Fetishize problems, not solutions.</cite>
<a name="Networking"></a>
<div class="cen"></div>
<h2><a href="http://9ol.es/The5HardestThings.html#Optimization">⇦ Optimization</a>
  <a href="http://9ol.es/The5HardestThings.html#toc">⇪ Table of Contents</a>
  <a href="http://9ol.es/The5HardestThings.html#Security">Security ⇨</a>
<small>Chapter 2</small>
Networking</h2>
<h3>What is it?</h3>
<p>People doing stuff together.</p>
<p>The user experience of your product, but interaction between users having higher fidelity and more fluidity.</p>
<h3>Why does it sound easy?</h3>
<p>Oftentimes it's stated as asynchronous operations becoming more synchronous. For instance, someone making a comment and then everyone else being notified of it (Facebook's red alert notifications is a good example<sup></sup>). Other times it's something like "We are processing a bunch of stuff at various warehouses and our system is really inefficient because blah blah blah."</p>
<h3>Why is it hard?</h3>
<p>All networking problems are basically a <a href="http://en.wikipedia.org/wiki/Actor_model">generalized form</a> of the following:</p>
<em>Doing an Action <i>A</i> on one Device <i>X</i> causes an Action <i>B</i> to happen on another Device <i>Y</i>.</em>
<p>This sounds easy. It's really easy for managers to gloss over the very valid picky nerd objections here:</p>
<ul>
<li>What if <i>Y</i> isn't ready to do what you want it to?
</li><li>What if <i>X</i> <a href="http://www.motama.com/content/docs/comm/sect_error_handling.htm#SECT_ERROR_HANDLING_TIMEOUT">can't contact</a> <i>Y</i>?
</li><li>How quickly must <i>Y</i> be done as a result of <i>X</i>?
</li><li>What if someone on <i>Y</i> is doing <i>A</i> at the <a href="http://en.wikipedia.org/wiki/Race_condition#Networking">same time</a>?
</li><li>What if you hear back from <a href="http://www.symantec.com/connect/blogs/dns-pharming-attacks-using-rogue-dhcp">some other</a> Device <i>Z</i>, then <i>Y</i>?
</li><li>What if <i>X</i> is an <a href="http://en.wikipedia.org/wiki/Backward_compatibility">older version</a> of your software than <i>Y</i>?
</li></ul>
<p>The most important things to understand is that networking is extraordinarily similar to <a href="http://en.wikipedia.org/wiki/Parallel_computing#Race_conditions.2C_mutual_exclusion.2C_synchronization.2C_and_parallel_slowdown">parallel programming</a>, only an order of magnitude more difficult.</p>
<p>You are still dealing with multiple parties vying for an <a href="http://en.wikipedia.org/wiki/Test-and-set">acquisition of</a> a scarce resource and perhaps not having a <a href="http://en.wikipedia.org/wiki/CAP_theorem">consistent view of its state</a>, but now you have the problem of those parties just disappearing and reappearing randomly and the consumer having the expectation that none of this matters and everything should just pick up where it left off.</p>
<h4>The Great Computing Flash Mob</h4>
<p>Here's an example of where things can get hard. <a href="http://en.wikipedia.org/wiki/Exponential_backoff">Back off algorithms</a>. The idea is that you try to maintain contact with a node and if it goes down you then "back-off" in the frequency upon which you try by some algorithm, since if you continue to incessantly try at a high rate you can bog down the resources of the machine that is trying, the network it is trying on, and things like that.</p>
<p>Well, let's assume that it's not <i>X</i> talking to <i>Y</i> but it's <i>[A ... X]</i> nodes talking to a single node <i>Y</i>. A network partition hits and they all, relatively simultaneously detect it and then back off, simultaneously.</p>
<p>So what happens is that at the computed back-off interval you see a packet from every single node <a href="http://en.wikipedia.org/wiki/Blocking_probability#Erlang_B_formula">hitting the network at once</a>. And then, when <i>Y</i> comes back, they all, in unison, do some kind of fantastic <a href="http://en.wikipedia.org/wiki/Ddos#Distributed_attack">DDoS</a> attack because all of their back-off algorithms were <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.17.4747&rep=rep1&type=pdf">relatively in sync</a>.</p>
<p>Oops. Ok, not doing your homework, but <a href="http://en.wikipedia.org/wiki/Kendall%27s_notation#A:_The_arrival_process">taking a good guess</a> you do something like throw some <a href="http://en.wikipedia.org/wiki/Poisson_distribution#Generating_Poisson-distributed_random_variables">Poisson random variable</a> in there. So now you have some nodes knowing before others that <i>Y</i> is back online. <a href="http://en.wikipedia.org/wiki/M/M/1_queue">What happens</a>? Do they submit this information in <a href="http://www.cs.cornell.edu/home/rvr/papers/flowgossip.pdf">some kind of gossipy protocol</a> amongst themselves? <a href="http://en.wikipedia.org/wiki/Little%27s_law">How big</a> must such a random interval be to guarantee that you aren't causing a problem? This stuff is hard.</p>
<a name="Network.random"></a>
<p>And that's a basic disconnect. Even without a disconnect and even with <a href="http://en.wikipedia.org/wiki/Transmission_Control_Protocol#Reliable_transmission">TCP</a>, you still have <a href="http://en.wikipedia.org/wiki/Indeterminacy_in_concurrent_computation">to accommodate</a> <i>A</i> coming in before <i>B</i> and <i>B</i> coming in before <i>A</i>, you know, <a href="http://en.wikipedia.org/wiki/Binomial_coefficient">this thing</a>. Good luck with that.</p>
<p>This is because, realistically if you are trying to do Action <i>A</i> on Device <i>X</i> yielding Action <i>B</i> on Device <i>Y</i> what you have is <a href="http://en.wikipedia.org/wiki/State_%28computer_science%29">State</a>. That's what state is. You can say that Action <i>A<sub>1</sub></i> doesn't depend on Action <i>A</i>, which is great, if you can do that. But <i>X(A) -&gt; Y(B)</i> is a state-ful <a href="http://en.wikipedia.org/wiki/Two-phase_locking">transform</a>. And state-fullness is the cause of <a href="http://www.defmacro.org/ramblings/fp.html">lots of programming errors</a> that are really hard to recover from.</p>
<a name="Networking.sanity"></a>
<h3>What can you do to maintain sanity?</h3>
<p>Avoid state as much as possible. This is as opinionated as it sounds. Take HTTP for instance. It's claim to fame is <a href="http://en.wikipedia.org/wiki/Stateless_protocol">how state-less</a> it is. In fact, things like <a href="http://en.wikipedia.org/wiki/HTTP_cookie#Implementation">cookies</a> are needed to give it a semblance of state. And HTTP works terribly well. This is where you need to go in your applications.</p>
<p>Additionally, you need to understand and if possible define (definitions can change) the following:
</p><ul>
<li>Acceptable latency in generality and for some things specific in your application, if applicable.
</li><li>Expected availability of your nodes and when you expect data to be consistent.
</li><li>Who is responsible at what time for what state and piece of data.
</li></ul>
<p>These should be defined and then treated as <a href="http://en.wikipedia.org/wiki/Construction_and_Analysis_of_Distributed_Processes">dictatorial laws</a>. If someone asks for anything slightly beyond it, such as "The system is down, I'm getting 92% uptime" and you defined it as <a href="http://en.wikipedia.org/wiki/Nines_(engineering)">90%</a>, it is in your right to say it's <a href="http://en.wikipedia.org/wiki/Software_requirements_specification">out of scope</a> and therefore, you don't care. We'll cover more about when it's ok to be a jerk in the section on reliability.</p>
<p>The important thing here is that if you refuse to put your foot down, you'll create a culture of accommodation and paralyze forward-moving development. Such limits need not always be defined, but in certain areas, there's no other reasonable way to deal with it. Five hours of your time is five hours, regardless of whether it was helping someone or progressing the product.</p>
<cite>Make it dumb before making it smart.</cite>
<a name="Security"></a>
<div class="cen"></div>
<h2>
<a href="http://9ol.es/The5HardestThings.html#Networking">⇦ Networking</a>
<a href="http://9ol.es/The5HardestThings.html#toc">⇪ Table of Contents</a>
<a href="http://9ol.es/The5HardestThings.html#Reliability">Reliability ⇨</a>
<small>Chapter 3</small>
Security
</h2>
<h3>What is it?</h3>
<p>Preventing people from doing stuff you don't want them to.</p>
<p>Generally, you, or at least your manager, probably want your product to be used only in ways it was intended.</p>
<p>Whether this desire is manifested by "a malicious user not gaining access" or "something having complex permission systems", it's all the same general request.</p>
<h3>Why does it sound easy?</h3>
<p>The idea is that you built something to do <i>X</i>. Of course it will do only <i>X</i>. Why would it do anything else?</p>
<p>Maybe you discover a few things, <i>Y</i>, and <i>Z</i>, that are also possible. Then you make sure they aren't. Total cakewalk!</p>
<h3>Why is it hard?</h3>
<p>You are wrong. You are so dead wrong. You didn't see operations <i>A - W</i> you fool, and now that crafty spy is downloading all your datas. The core of the problem has been a popular observation lately (July 2012): You have written software on a general purpose reprogrammable computer.<sup></sup> One that does only what it's told to, totally agnostic to the social norms of the world around it.</p>
<p>I once came in contact with a security system at a research lab. All of the doors had a 10-digit access pad that would unlock the door and let people in. Therefore, ostensibly, there are 2 ways of getting in:</p>
<ol>
<li>You know the code
</li><li>You have a key
</li></ol>
<p>The problem is that since we have a general-purpose door-opening computer just remove the faceplate and place a staple on two specific contact points on the PCB.</p>
<p>The unlocking computer doesn't care how it was instructed it to unlock the door. The necessary wire got the necessary charge and the door opened.</p>
<p>This is the general synopsis of security. It's a race of creativity. And even if you think you have found all the creative ways that a person can use your general purpose device, you are probably incorrect. Remember, your authorization mechanism wants to authorize people.</p>
<h4>Hacking The Sneaker Net</h4>
<p>The other problem is that people may have just voluntarily opened the door for me.</p>
<p>Your vulnerability count is at least equal to your access count.</p>
<p>What more, mechanized onerous security measures are more susceptible to <a href="http://en.wikipedia.org/wiki/Social_engineering_%28security%29">social manipulation</a>. Only humans will ever care who is gaining access, and they are subject to empathy and other forms of manipulation: "Let me help the new guy, woops."</p>
<p>In <a href="http://www.npr.org/templates/transcript/transcript.php?storyId=139677992">this interview</a>, <a href="http://en.wikipedia.org/wiki/Kevin_Mitnick">Kevin Mitnick</a> talks about how he utilized social engineering:</p>
<q><p>MITNICK: ... we installed a new upgrade to the password changing program and I need you to test it. And then I'd have the target change her password to something I knew. Like, oh, yeah. Just for the test, let's change your password to test 1, 2, 3, 4.</p>
<p>And by the way, do not give me your old password. And I'd lecture the person on security guidelines that you should never, ever give out your password. I'd have them change it to something that I suggested, and then I'd have them test their applications. And when they were testing everything, I was already into that person's account.</p>
</q>
<h3>What can you do to maintain sanity?</h3>
<p>There's something called a <a href="http://en.wikipedia.org/wiki/Threat_model">threat model</a>. Depending on the academic literature de jour<sup></sup>, this means something different. But basically the idea is to understand what the implications are if someone manages to do something unintended with your product or service.</p>
<p>Threat models (sometimes "risk models") are incomplete, but better-than-not-doing-it profiles of your technology. Ask yourself the following questions:</p>
<a name="Security.risk"></a>
<ul>
<li>Is the stuff I work with (or the stuff that the user stores on the stuff I work with) of any real value outside the world of my product?
</li><li>Even within the world of my product and brand, how important is it? How important is one part versus another?
</li><li>Am I willing to make any guarantees on what someone cannot do with the product? Under what conditions am I willing to make this guarantee?
</li><li>What type of dedication, sophistication, resources, and intent am I prepared for?
</li></ul>
<p>For instance, I recently worked on a product where a users content wasn't as private as their authentication token. So we made the decision that the access token has much higher security then the content.</p>
<p>Windows 95 and 98 were like this. The login prompt that you could enable <a href="http://www.youtube.com/watch?v=v9Jeit6cVaQ">didn't lock down the system at all</a>.</p>
<p>The <a href="http://en.wikipedia.org/wiki/File_Allocation_Table">FAT32</a> file system didn't have <a href="http://en.wikipedia.org/wiki/Access_control_list">ACL</a>s, processes <a href="http://technet.microsoft.com/en-us/library/cc751120">didn't really care about owners</a>, etc. Windows 95/98/ME were not <a href="http://en.wikipedia.org/wiki/Network_operating_system">Network Operating Systems</a>. It was the <a href="http://en.wikipedia.org/wiki/Windows_95#Architecture">traditional</a> microcomputer OS <a href="http://ns1.nt.net/test1/files/How%20to%20Configure%20Static%20IP%20in%2095_98_me.pdf">pretending</a> to be a NOS (this all changed with Windows XP).</p>
<p>A proper security stack isn't free. It's hard.</p>
<a name="Security.needed"></a>
<h4>Do What's Needed, Then Stop.</h4>
<p>At a certain bank you need to swipe your card to open up a door and access the ATMs. The card reader however, is hooked up to nothing but the unlocking mechanism of the door. You can scan any card, such as a public transit card you bought with cash that has no identifiable information, and the door opens.</p>
<p>This is all that is needed.</p>
<p>The customers feel secure, other bank card holders can still access the ATMs, and muggers would be caught on security camera anyway. Besides, the existence of the mechanism implicates what it does. Whether it actually achieves it or not is often immaterial to the affected parties.</p>
<p>Also, now the real infrastructure is in place to restrict access and track people. It's just that threat hasn't escalated enough to justify maturing the technology to its full potential.</p>
<p>They did what was needed, and then stopped.</p>
<cite class="right">Despite the effectiveness ... it's probably not worth the cost<i>from <a href="http://arstechnica.com/science/2012/06/economists-demonstrate-exactly-why-bank-robbery-is-a-bad-idea/">
why bank robbery is a bad idea</a></i></cite>
<p>You do this all the time. It's called <a href="http://en.wikipedia.org/wiki/Actuarial_science">actuarial analysis</a>. Would you put an <a href="https://store.lojack.com/category.aspx?zcid=103">expensive theft tracker</a> in a $600 car?  What about a safe in the trunk to store your loose change for the parking meter?</p>
<h4>No Narratives</h4>
<p>Narrative-based security is when people respond to a previous threat. Someone had explosives in their shoes so now everyone takes off their shoes. So next time, when someone has explosives in their toupee, the ATF will be combing through everyone's hair.</p>
<p>The truth is whether it's someone sneaking in the food service door to the exclusive event or bringing the entire nation to a stand still with a pair of box cutters, the attack vector of <a href="http://www.forbes.com/sites/andygreenberg/2012/07/23/hacker-will-expose-potential-security-flaw-in-more-than-four-million-hotel-room-keycard-locks/">basic ingenuity</a> is just so vast that it is almost impossible to address it without affecting the very soul of your product and experience.</p>
<p>Narrative-driven security can satisfy the requirements only if the requirements are to manage the fears of your customers (see the bank example). Otherwise, it's just ceremonies done in the name of security, as if a magical ritual will appease the Goddess Securitia to breathe safety into your product.</p>
<p>Given the difference between perceptive security, real security, the challenges of general purpose computing, the difficulties of encryption, physical security, all of that, the core problem is still that <i>Security is a race of creativity</i>.</p>
<cite>Understand what's possible and embrace it.</cite>
<a name="Reliability"></a>
<div class="cen"></div>
<h2>
  <a href="http://9ol.es/The5HardestThings.html#Security">⇦ Security</a>
  <a href="http://9ol.es/The5HardestThings.html#toc">⇪ Table of Contents</a>
  <a href="http://9ol.es/The5HardestThings.html#Scalability">Scalability ⇨</a>
<small>Chapter 4</small>
Reliability</h2>
<h3>What is it?</h3>
<p>Stuff not breaking.</p>
<p>No really, that's it. Having stuff that works well.</p>
<h3>Why does it sound easy?</h3>
<p>There's finite code, finite state, so finite bugs. So long as you don't really change stuff you'll eventually find them, address them, and then have a stable, mature platform.</p>
<p>And besides, how hard could it be? You've come prepared for everything, right?</p>
<h3>Why is it hard?</h3>
<p>See "Why does it sound easy?". The asymptotic ride to <a href="http://en.wikipedia.org/wiki/Stability_Model">stability</a> can take months or years. Oftentimes far exceeding the patience and motivation of the creator. You're ready to move on, but it keeps coming back, like some bad horror movie that just ends up <a href="http://en.wikipedia.org/wiki/Year_2000_problem">being irritating</a>.</p>
<p>There's really a few kinds of reliability:</p>
<ul>
<li>Everything works under your envisioned use cases
</li><li>Everything works in pure spite of your limited vision of use cases
</li><li>Everything works when everything else around it is engulfed in flames and combusting loudly
</li></ul>
<p>Most programmers only have to ever satisfy the first requirement.</p>
<p>You don't know how lucky you are. Really. This discussion will mostly focus on you, the third group includes things like the <a href="http://en.wikipedia.org/wiki/Flight_data_recorder">black box</a> on an airplane and other marvellous things that are <a href="http://en.wikipedia.org/wiki/Hardened_computer">supposed to survive</a> spontaneous <a href="http://en.wikipedia.org/wiki/Gun_data_computer">explosions</a> and your <a href="http://www.reuters.com/article/2012/05/09/uk-indonesia-sukhoi-idUSLNE84802D20120509">product slamming</a> into mountain sides. If you are <a href="http://en.wikipedia.org/wiki/Six_Sigma#Certification">in that industry</a>, you are probably quite capable of skipping this.</p>
<p>So why is the first one hard?</p>
<p>Let's characterize every program you wrote in school, ever:</p>
<q>Your program must complete task X. It will be running for at most a few minutes, and will at most only need to do a task a few times</q>
<p>Now here is every program you will write professionally, ever:</p>
<q>Your program must complete task X, every day, for as long as we stay in business. If it fails at task X, it will cost us <a href="http://www.informationweek.com/news/storage/disaster_recovery/229625441">substantial amounts</a> of <a href="http://www.evolven.com/blog/downtime-outages-and-failures-understanding-their-true-costs.html">reputation</a> and <a href="http://www.sudora.com/downtime.html">money</a>. Please, for the love of God, don't ever fail at doing X.</q>
<p>When people talk about the great developer being worth <a href="http://benlakey.com/2012/07/01/hire-great-developers/">20 times more</a> than the good one, the very soul that defines the valley between good and great are <a href="http://www.engineyard.com/blog/2011/the-number-one-trait-of-a-great-developer/">those</a> who <a href="http://www.engineyard.com/blog/2011/the-number-one-trait-of-a-great-developer/">will</a> do <a href="http://sivers.org/how2hire/">the second</a> and those who <a href="http://www.yacoset.com/Home/signs-that-you-re-a-bad-programmer/">can only</a> do <a href="http://www.tonido.com/blog/index.php/2009/02/17/10-ways-to-be-really-bad-programmer/">the first</a>.</p>
<p>It's the difference between the person you can trust to get the job done and the person you can trust <a href="http://www.udidahan.com/2007/08/06/dont-trust-developers-with-project-management/">to work under</a> the person who you are trusting to get the job done.</p>
<h4>What does <i>Reliability</i> mean?</h4>
<ul>
<li>Your program will not crash, ever.
</li><li>Your program will be just as responsive after a year as it is after a day.
</li><li>Your program will respond dynamically, almost sentiently to the changing world around it.
</li><li>Your users will forget that your program exists.
</li></ul>
<p>The last one takes some explaining. When you were a kid and your parents had a land-line (this should cover everyone), you picked up a phone and got a dial-tone. Did you ever pick it up and be like "Hrmm, AT&amp;T must have crashed, I can't make a phone call". Thought not. If you had a phone that didn't require power you may have been lucky enough to discover how the AT&amp;T phone network easily beat the power grid in stability during storms.</p>
<p>Here's another one: radio stations. After natural disasters, radios are often one of the first things that people turn to. Well, how do the radio station survive when everything else does not?</p>
<p>And that's our segue...</p>
<h3>What can you do to maintain sanity?</h3>
<p>There's a big fat important thing every engineer should know about reliability: It's counter-intuitive and flies in the face of all <i>Proper Engineering</i>.</p>
<p>There's lots of manifestos out there on Software Engineering but one of the few things they agree on is that simple, elegant, robust solutions are awesome. So awesome that they should be your <a href="http://www.jwz.org/doc/worse-is-better.html">top priority</a>.</p>
<p>Working towards reliability however, is different in that you:</p>
<ul>
<li>Write <a href="http://en.wikipedia.org/wiki/Exception_handling">more code</a> that does less.
</li><li>Diversify and minimize your <a href="http://en.wikipedia.org/wiki/Single_point_of_failure">points of failure</a>.
</li><li><a href="http://en.wikipedia.org/wiki/Coupling_%28computer_science%29">Decouple</a> and focus on <a href="http://en.wikipedia.org/wiki/Cohesion_%28computer_science%29">cohesion</a>.
</li><li>Make sure that all modes of failure are either obnoxiously loud or handled silently.
</li><li>Re-implement a solution multiple times and have those implementations <a href="http://en.wikipedia.org/wiki/Fault-tolerant_computer_system">check each other</a>.
</li></ul>
<p>The reason that AT&amp;T and the radio station could stay impeccably solid is because they didn't do much, relied on as few externalities as possible, knew when they <a href="http://www.eventhelix.com/RealtimeMantra/FaultHandling/system_reliability_availability.htm">could expect</a> something to fail, and focused on making sure that the one thing that they did, they could continue to do.</p>
<p>In the UNIX philosophy and In the Valley, there is a popular saying: <a href="http://www.faqs.org/docs/artu/ch01s06.html">"Do one thing and do it well"</a>. Same here. The goal is to make sure that a fault in your application <a href="http://en.wikipedia.org/wiki/Loose_coupling">only affects</a> the thing that faulted it.</p>
<p>When you <a href="http://en.wikipedia.org/wiki/Software_package_metrics">scope</a> and set the parameters of your application, it's much easier to understand what you intend to, versus do not intend to, support. And when you are forced to actually state what your program does, you will more then likely back-off from what you want it to do and only state what you actually think it can do.</p>
<p>And that's a step in the right direction.</p>
<p>Re-implementing your solution isn't necessarily important, unless your data is. You should never trust just one way of solving any problem. There's various names for this in other industries, for instance <a href="http://nextlevelpurchasing.com/articles/dual-source.html">Dual-sourcing</a> and <a href="http://en.wikipedia.org/wiki/Second_source">Second source</a>.</p>
<p>Other examples include the Boeing 787, which has <a href="http://en.wikipedia.org/wiki/Boeing_787_Dreamliner#Engines">*swappable* engines</a>, <a href="http://en.wikipedia.org/wiki/Cassini%E2%80%93Huygens#Huygens_probe">NASA's stuff</a>, and Tandem's Non-Stop architecture, whose machines <a href="http://fault-tolerance.wikispaces.com/file/view/goal.pdf">famously stayed on during the 1989 SF earthquake</a> that <a href="http://en.wikipedia.org/wiki/1989_Loma_Prieta_earthquake#San_Francisco_.E2.80.93_Oakland_Bay_Bridge">toppled</a> the upper deck of the Bay Bridge.</p>
<p>The biggest news is that you to can enjoy the benefits of such forms of engineering, for the most part, when you have redundant programs that verify each other; however much work that sounds.</p>
<cite>Don't trust. Always verify.</cite>
<a name="Scalability"></a>
<div class="cen"></div>
<h2>
  <a href="http://9ol.es/The5HardestThings.html#Reliability">⇦ Reliability</a>
  <a href="http://9ol.es/The5HardestThings.html#toc">⇪ Table of Contents</a>
  <a href="http://9ol.es/The5HardestThings.html#Conclusion">Conclusion ⇨</a>
<small>Chapter 5</small>
Scalability</h2>
<h3>What is it?</h3>
<p>Doing lots of very similar stuff.</p>
<p>Often times this will be accompanied with conditionals such as "over many computers" or "over diverse localities". The core component, however, is that your system, which is designed to handle <i>X</i> of something, should be able to handle <i>10 * X</i> of something.</p>
<h3>Why does it sound easy?</h3>
<p>Non-programmers see this as a resource problem. Managers often think, "well, can't we just buy more computers and then run this on all of them?"</p>
<p>It's a very sensible conclusion. If you are moving things in boxes, you can move things faster if you have more people moving more boxes.</p>
<h3>Why is it hard?</h3>
<p>Of course the world isn't that simple. Even in the "move more boxes" analogy, you've got a problem; the workers probably can't synergistically,
in isolation, decide who moves what where without any communication or contact.</p>
<p>And that's the problem ... well, one of them.</p>
<p>You see, <i>scalability</i> doesn't really introduce new problems we haven't seen up to this point as much as it's a conspiracy of all of them.</p>
<p>Remember the section in <a href="http://9ol.es/The5HardestThings.html#Optimization">optimization</a> about <a href="http://9ol.es/The5HardestThings.html#Optimization.cache">cache control</a>? Same thing here, 
but instead of all of those things being a result of you trying to think you can cheat out performance gains with a cache, it's a direct consequence of running multiple things on different machines.</p>
<cite class="right">Scaling = replacing all components of a car while driving it at 100mph. <i>From <a href="http://techcrunch.com/2012/04/12/how-to-scale-a-1-billion-startup-a-guide-from-instagram-co-founder-mike-krieger/">Scaling instagram</a></i></cite>
<p>Remember that section in <a href="http://9ol.es/The5HardestThings.html#Networking">networking</a> about how things can be <a href="http://9ol.es/The5HardestThings.html#Network.random">out of order</a>, inconsistent, unreliable, and just plain break?  Yes, you'll have to deal with that now too, as an inherent property of the system.</p>
<p>Remember that section in <a href="http://9ol.es/The5HardestThings.html#Security">security</a> on <a href="http://9ol.es/The5HardestThings.html#Security.risk">assessing risk</a>?  Well once you scale from data center to data center or off to third party services, you've opened up your application to the wild untamed Internet. How Fun.</p>
<p>Remember <a href="http://9ol.es/The5HardestThings.html#Reliability">reliability</a>? Now your application will have 10 or 20 times more points of failure. And if you don't watch it, it means you will fail 10 or 20 times <a href="http://storagemojo.com/2007/02/19/googles-disk-failure-experience/">more often</a>.</p>
<a name="Scalability.sanity"></a>
<h3>What can you do to maintain sanity?</h3>
<p>15 years ago many programmers would have never have to consider the problems of scalability. Now it is not only becoming increasingly relevant, but increasingly assumed with the rise of <a href="https://twitter.com/hipsterhacker/status/57492539883798528">The Cloud</a>.</p>
<p>Luckily computers are fast. <a href="http://en.wikipedia.org/wiki/Moore%27s_law">Moore's Law</a> is a wonderful thing and reports of its death have been greatly exaggerrated (It may be <a href="http://techland.time.com/2012/05/01/the-collapse-of-moores-law-physicist-says-its-already-happening/">coming</a> though).</p>
<h4>NoSQL</h4>
<p>Just kidding. This isn't <i>that kind of discussion</i>.</p>
<p>But really, disks will be the <a href="http://highscalability.com/youtube-architecture/">first issue</a> if you have any. They store absolutely <a href="http://www.jcmit.com/diskprice.htm">astounding</a> amounts of data these days and are still horrible when it comes to trying to service a bunch of things at once.<sup></sup></p>
<p>Actually your architecture of creating lots of <a href="http://serverfault.com/questions/6711/filesystem-for-millions-of-small-files">small files</a> and doing things inefficiently is the first problem. More computers won't help you as much as more competence. Don't have time for competence? Disks it is then!<sup></sup></p>
<p>Have a nice rack of them, or better, use some third party provider. But watch out! <a href="http://social.msdn.microsoft.com/Forums/en-US/windowsazuredata/thread/482ff156-5914-4058-b96e-14f6900a089f/">Done poorly</a>, <a href="http://en.wikipedia.org/wiki/Content_delivery_network">CDN</a>s can work against you. Don't do <a href="http://en.wikipedia.org/wiki/Dedicated_hosting_service">managed hosting</a><sup></sup> if you like having money.<sup></sup> CDNs and things like <a href="http://en.wikipedia.org/wiki/Amazon_Web_Services">AWS</a> are nice because:</p>
<ul>
<li>Replacing disks and doing back-up sucks (time that is).
</li><li>They aren't pricey.
</li></ul>
<p>Now that's not hard is it?</p>
<p>As far as distributed systems go, there's been a lot of movement in the past few years<sup></sup>. <a href="http://pragprog.com/book/rwdata/seven-databases-in-seven-weeks">This book</a> tries to cover it. Here's a <a href="http://www.socallinuxexpo.org/scale10x/presentations/modern-memcached">decent talk</a> by a memcached author - go to about 9min 50s in for a special treat.</p>
<p>There's <a href="http://eranki.tumblr.com/post/27076431887/scaling-lessons-learned-at-dropbox-part-1">lots</a> written <a href="http://code.flickr.com/blog/2010/02/08/using-abusing-and-scaling-mysql-at-flickr/">about</a> scalability <a href="http://www.infoq.com/news/2010/05/7-Lessons-Reddit">these</a> days. <a href="http://highscalability.com/">Here's a good blog</a> dedicated to it.
</p><p>This is one where homework is really what you need to do. It's a shopping trip; break down your product into things that you do and then find the tools, and perhaps, a one-stop-shop that does it well.</p>
<p>But don't do this before your product is actually you know, <a href="http://www.jwz.org/doc/cadt.html">done</a>. It's always easier to shop when you actually know what you need.<sup></sup>
</p>
<cite>Get ten thousand customers before worrying about ten million.</cite>
<a name="Conclusion"></a>
<div class="cen"></div>
<h2>
  <a href="http://9ol.es/The5HardestThings.html#Scalability">⇦ Scalability</a>
  <a href="http://9ol.es/The5HardestThings.html#toc">⇪ Table of Contents</a>
<small>Chapter 6</small>
Conclusion</h2>
<p>Hopefully this adventure has given a little more insight or at least confirmation to some of the art of engineering a product that you can actually put out in the world without people totally hating it.</p>
<p>An important thing to note is that when it comes to any of the things above, depending on your application you may be able to get it for free or avoid it entirely.</p>
<p>If you have this opportunity, and you are developing software commercially, and it's not aligned with your goal, then for the love of God, don't venture into the Lions' Den, unless you want total abject masochism.</p>
<p>We can hijack the famous <a href="http://c2.com/cgi/wiki?PrematureOptimization">Donald Knuth quote</a> and repurpose it as "Never do or claim <i>X</i> prematurely" with <i>X</i> being one of the things above. In fact, let's come up with a new one:</p>
<q>Don't optimize, network, secure, scale, or stabilize. Offload it, outsource it, avoid it at all costs. If you have to do it, anticipate it from Day One, but don't ever take action on it until everything else is figured out and you actually need it.</q>
<p>Each one of these are reactive patterns to consumer driven habits. You never know how much of any one you'll need until late in the game.</p>
<p>It's also worth noting that there is a significant problem not covered here: <a href="http://stackoverflow.com/questions/395247/examples-of-usability-disasters">Usability</a>. Since it didn't fit the formulaic model of the rest of the issues, it had to be omitted.</p><p>
</p><p>However, effectively communicating your product to your users is the <i>hardest</i> of hard and deserving of its own article of this size.</p>
<h3>Where to go from here</h3>
<p>Certain things are a perpetual foot-dragging problem, with the computer dragging the feet. The hardest thing is to minimize the amount of time in your day you are doing this.</p>
<cite>Have a beautiful day!</cite>
<div class="cen"></div>
<h5>About</h5>
<div style="font-size:0.8em">
<p>The author is Chris McKenzie; a programmer dedicated to truth, no matter how crazy it gets. <a href="http://9ol.es/">Go to the front page</a>.
</p><p>Thanks to Alan Chen, Allen Gittelson, <a href="http://lifftchi.livejournal.com/">Chris Takemura</a>, Dima Kogan, <a href="http://www.reddit.com/r/programming/comments/wnzna/why_programming_is_difficult/c5f7xcp">fmota</a>, <a href="http://www.updike.org/">Jared Updike</a>, John Underkoffler, Ken Waters, <a href="http://meschbach.com/">Mark Eschbach</a>, Michael Schuresko, and <a href="http://www.reddit.com/r/programming/comments/wnzna/why_programming_is_difficult/c5f2zii">ninereeds314</a> for help in editing and putting this article together. Also, thanks to Ram Ramanath who was the colleague that I did the Ruby performance exploration with.</p>
<p>Thanks to <a href="https://twitter.com/nicktea/status/227525687928573952">Nick Treadway</a>, <a href="https://twitter.com/kevin_rudds_cat/status/225938660384702464">Keith Moss</a>, <a href="https://twitter.com/joseph_carney/status/225642364453138433">Joseph Carney</a>, <a href="https://twitter.com/ViejoGabicho/status/225556619566653441">G. Gabriel Ruales</a>, <a href="https://twitter.com/volothamp/status/225486863752896512">Luca Molteni</a>, <a href="https://twitter.com/jgemedina/status/225361435776122880">Jorge Medina</a>, <a href="https://twitter.com/arikan/status/225247703293104128">Burak Arikan</a>, <a href="https://twitter.com/jakeasmith/status/224956797897801728">Jake A. Smith</a>, <a href="https://twitter.com/G64/status/225100455317999616">Terence Tuhinanshu</a>, <a href="https://twitter.com/kristoffer_nord/status/225135520978698240">Kristoffer Nordstrom</a>, <a href="https://twitter.com/ya_pulser/status/225504491988983808">Ilya Teterin</a>, <a href="https://twitter.com/mariofusco/status/225483976461123584">Mario Fusco</a>, <a href="https://plus.google.com/u/0/112615044900336574772/posts/RGUc7SnCfC5">Levi Gross</a>, <a href="https://plus.google.com/u/0/110381221612482769681/posts/Vg2STN9zyNK">Muhammad Aboulmagd</a>, <a href="https://plus.google.com/u/0/107680654974055012983/posts/UbXtuhohjB8">Mickey Kawick</a>, <a href="https://plus.google.com/u/0/112667414731176105029/posts/QEeRnvoNmVy">Wojciech Pietrzak</a>, <a href="http://www.dzone.com/links/the_five_hardest_parts_of_programming.html">Sylvain Soliman</a>, <a href="https://plus.google.com/u/0/110758913726534948012/posts/V4yN5ft9qFS">Clinton Paquin</a>, <a href="https://plus.google.com/u/0/103647580612402146818/posts/KfqtZaoaTV1">Torsten Schroder</a>, <a href="https://plus.google.com/u/0/118061425931094604344/posts/Rh8fDbgN5VC">Janos Bodn</a>, <a href="https://plus.google.com/u/0/104360672727468700141/posts/jJqHjC7r3EU">Arash Bannazadeh-Mahani</a>, <a href="https://plus.google.com/u/0/114856772814084923287/posts/5K1j76SH69Q">Francois Buhagiar</a>, <a href="https://plus.google.com/u/0/106229464860197199884/posts/agqu1coZP8b">Amira Sya'diah</a>, <a href="https://plus.google.com/u/0/117733030127671014719/posts/dh6ZW9BaCJ8">Jerome Faria</a>, <a href="https://plus.google.com/u/0/101951111252248832466/posts/N3Nkfsn9Vxd">Stephen Foster</a>, <a href="https://twitter.com/jacki3lene/status/225620059563892736">Jackielene Camomot</a>, <a href="https://twitter.com/KodefuGuru/status/225560873345888259">Chris Eargle</a>, <a href="http://www.dzone.com/links/the_five_hardest_parts_of_programming.html">dzone</a>, <a href="http://www.dotnetpro.de/service/link178.aspx">dotnetpro</a>, <a href="https://www.progclub.org/blog/2012/07/19/the-5-hardest-parts-of-programming/">progclub</a>, and <a href="http://www.codeproject.com/insider.aspx?msg=4311171">Code Project</a> for the publicity. 
</p>
<h4>Comments</h4>
<p>I welcome comments and critiques of this article on <a href="http://news.ycombinator.com/item?id=4250416">Hacker News</a> and <a href="http://www.reddit.com/r/programming/comments/wnzna/why_programming_is_difficult/">Reddit</a>.</p>
</div>
<ol class="notes" id="notes">
<li>See also <http: kristopolous.blogspot.com="" 2011="" 11="" acid3-of-js-has-few-surprises.html="">The Acid3 of JS has a few surprises.
</http:></li><li>In 1968, David Evans and Ivan Sutherland, both professors of computer science, founded a company to develop a special graphics computer known as a <a href="http://www.computerhistory.org/timeline/?year=1968">frame buffer</a>.
</li><li>There's other uses for this "jump without context" idea, such as in <a href="http://en.wikipedia.org/wiki/Unix_signal#Handling_signals">handling signals</a> or <a href="http://en.wikipedia.org/wiki/Longjmp#Example_usage">exception handling</a> in C.
</li><li>See <a href="http://www.joelonsoftware.com/articles/fog0000000069.html">Things You Should Never Do, Part I</a> for a good synopsis of what a QA clock reset does.
</li><li>"The most resource-intensive operation performed in a chat system is not sending messages. It is rather keeping each online user aware of the online-idle-offline states of their friends, so that conversations can begin." From <a href="http://www.facebook.com/note.php?note_id=14218138919&id=9445547199&index=0">Facebook Chat</a>.
</li><li>See <a href="http://boingboing.net/2011/12/27/the-coming-war-on-general-purp.html">The Coming War on General Purpose Computation</a> and the <a href="http://www.readwriteweb.com/cloud/2012/01/the-four-horsemen-of-the-gener.php">buzz</a> <a href="http://www.techdirt.com/articles/20111231/01431617249/ongoing-war-computing-legacy-players-trying-to-control-uncontrollable.shtml">it</a> <a href="http://yro.slashdot.org/story/11/12/30/2159200/doctorow-the-coming-war-on-general-purpose-computing">created</a>.
</li><li><a href="https://www.owasp.org/index.php/Threat_Risk_Modeling">OWASP</a>, <a href="http://msdn.microsoft.com/en-us/library/ff648644.aspx">Microsoft</a>, <a href="http://www.sans.org/reading_room/whitepapers/securecode/threat-modeling-process-ensure-application-security_1646">SANS</a>, <a href="http://msdn.microsoft.com/en-us/magazine/cc163519.aspx">STRIDE</a>, <a href="http://msdn.microsoft.com/en-us/magazine/cc163519.aspx">empirical</a>, <a href="http://ieeexplore.ieee.org/xpl/tocresult.jsp?isnumber=2296">Boehm</a>.
</li><li><a href="https://communities.netapp.com/community/netapp-blogs/dave/blog/2008/11/07/disk-is-the-new-tape-flash-is-the-new-disk">Disk is the new tape</a>. Also, <a href="http://stuartsierra.com/2008/04/17/disk-is-the-new-tape">here</a>.
</li><li>"Managed hosting can't scale with you. You can't control hardware or make favorable networking agreements." - <a href="http://highscalability.com/youtube-architecture/">Scaling Youtube</a>
</li><li><a href="http://www.comentum.com/dedicated-managed-hosting-comparison.html">"Firewalls"</a> will cost you $100 a month. "Backup" can be another $100. <a href="http://www.nethosting.com/products/dedicated-hosting">This site</a> for instance, has a princing plan that would <a href="http://www.ebay.com/itm/IBM-xSeries-x336-2x-3-0GHz-Xeon-64-Bit-4GB-4x-73G-HDD-Dual-P-S-1U-Server-/300739845023?pt=COMP_EN_Servers&hash=item46057ddb9f">buy an equivalent server</a> in half a single billing cycle. <a href="http://www.rackspace.com/managed_hosting/configurations/">Here's a bigger company</a> with the <a href="http://www.ebay.com/itm/SuperMicro0U-Server-2x-Quad-Core-2-5GHz-24gb-RAM-2x-750GB-Rails-SC811-QC-/390438955458?pt=COMP_EN_Servers&hash=item5ae7f9a9c2#ht_1693wt_763">same pattern</a>.
</li><li><a href="http://users.sdsc.edu/~mcdonald/content/papers/dt_cost.pdf">More disks</a> isn't a bad long-term policy. See the optimization section for more.
</li><li>There's <a href="http://www.drizzle.org/">Drizzle</a>, <a href="http://aws.amazon.com/dynamodb/">Dynamo</a>, <a href="http://redis.io/">Redis</a>, <a href="http://wiki.basho.com/">Riak</a>, <a href="http://voltdb.com/">Volt</a> and <a href="http://project-voldemort.com/">Voldemort</a>. <a href="http://cassandra.apache.org/">Cassandra</a>, <a href="http://couchdb.apache.org/">Couch</a>, <a href="http://memcached.org/">Memcache</a>, <a href="http://www.couchbase.com/membase">Membase</a>, <a href="http://www.erlang.org/doc/man/mnesia.html">Mnesia</a>, <a href="http://www.mongodb.org/">Mongo</a>, <a href="http://www.monetdb.org/Home">Monet</a>, <a href="http://mariadb.org/">Maria</a>, <a href="http://www.mysql.com/">MySQL</a>, <a href="http://hadoop.apache.org/">Hadoop</a> and <a href="http://hypertable.org/">Hypertable</a>, <a href="http://www.postgresql.org/">PostgreSQL</a>, <a href="http://search.carrot2.org/stable/search">Carrot2</a>, <a href="http://lucene.apache.org/core/">Lucene</a> and <a href="http://lucene.apache.org/solr/">Solr</a>. And I guess also Oracle. But all you may really need is something like <a href="http://en.wikipedia.org/wiki/Lustre_(file_system)">Luster</a> or <a href="http://en.wikipedia.org/wiki/GlusterFS">Gluster</a>.
</li><li>Shameless plug: A <a href="http://www.amazon.com/The-Book-Xen-Practical-Administrator/dp/1593271867">good friend</a> of mine runs <a href="http://prgmr.com/xen/">a VPS company</a>.
</li></ol>
<script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script src="./The Five Hardest Parts of Programming_files/note_header.js"></script>
<script src="./The Five Hardest Parts of Programming_files/href.js"></script>
</div><div id="menu"><a class="title" onclick="openMenu(this)">▼ articles</a><ul id="menu-contents"><li><a href="http://9ol.es/software-contracting-howto.html"><b>How to do Software Engineering Contracts</b><br>No really, something that works.</a></li><li><a href="http://9ol.es/ICMPTunnelGuide.html"><b>Sidestep Wireless Logins</b><br>Route all traffic through measly little ping packets</a></li><li><a href="./The Five Hardest Parts of Programming_files/The Five Hardest Parts of Programming.html"><b>The 5 Hardest Parts of Programming</b><br>Learning through pain, practice, and patience</a></li><li><a href="http://9ol.es/LinuxKeyboardShortcuts.html"><b>Linux and Programming Cheat Sheets</b><br>Various mappings and reminders to get you through the day</a></li><li><a href="http://9ol.es/TheEmperorsNewClothes.html"><b>The Emperor's New Clothes</b><br>Imagine a world where Bash supports JSON.</a></li><li><a href="http://9ol.es/PiggyPack.html"><b>Piggy Pack</b><br>Hiding things out in the open</a></li><li><a href="http://kristopolous.blogspot.com/2012/01/why-pirate.html"><b>Don't Pay For Content</b><br>They Don't Deserve Your Money</a></li><li><a href="http://kristopolous.blogspot.com/2011/11/what-nice-logo.html"><b>What a Nice Logo you have</b><br>Where Did You Find it?</a></li><li><a href="http://kristopolous.blogspot.com/2011/11/acid3-of-js-has-few-surprises.html"><b>The Acid3 of JS has a few surprises.</b><br>IE10 comes out on top.</a></li><li><a href="http://kristopolous.blogspot.com/2011/05/replacing-in-house-solutions-with-third.html"><b>Abandon your cake</b><br>Stop the DIY</a></li><li><a href="http://9ol.es/inotify.html"><b>Finding out when a file is accessed</b><br>A basic inotify utility</a></li><li><a href="http://9ol.es/fade.html"><b>Command-fu graphics premier</b><br>Dipping into the various sauciness</a></li><li><a href="http://9ol.es/javascript_loadlib.html"><b>Deferring the load</b><br>Script injection and detection</a></li></ul></div><script type="text/javascript" src="./The Five Hardest Parts of Programming_files/hrefresults.php"></script><iframe style="position:absolute;top:-10000px;left:-10000px"></iframe><iframe style="position:absolute;top:-10000px;left:-10000px"></iframe><iframe style="position:absolute;top:-10000px;left:-10000px"></iframe><iframe style="position:absolute;top:-10000px;left:-10000px"></iframe><iframe style="position:absolute;top:-10000px;left:-10000px"></iframe><iframe style="position:absolute;top:-10000px;left:-10000px"></iframe><iframe style="position:absolute;top:-10000px;left:-10000px"></iframe><iframe style="position:absolute;top:-10000px;left:-10000px"></iframe><iframe style="position:absolute;top:-10000px;left:-10000px"></iframe><iframe style="position:absolute;top:-10000px;left:-10000px"></iframe><iframe style="position:absolute;top:-10000px;left:-10000px"></iframe><div class="vimiumReset vimiumHUD" style="right: 150px; display: none;"></div></body><div></div></html>